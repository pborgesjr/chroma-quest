import React, {memo, forwardRef, useState, useImperativeHandle} from 'react';
import {Svg, Path} from 'react-native-svg';
import {Text, Pressable, Vibration} from 'react-native';
import {COLOR_PALETTE} from '../../theme';
import {ValueColorType} from '../../types';
import {delay} from 'lodash';
import {
  LIT_ANIMATION_DURATION,
  REPLAY_ANIMATION_DURATION,
} from '../../constants';

const {neutral} = COLOR_PALETTE;

export type ColorButtonRefType = null | {
  replayAnimation: () => void;
};

type ColorButtonProps = {
  value: ValueColorType;
  isDisabled?: boolean;
  onPress?: (value: ValueColorType) => void;
  useNumbers?: boolean;
};

//TODO: get color palette using context
const ColorValueButtonComponent = forwardRef(
  ({value, isDisabled, onPress, useNumbers}: ColorButtonProps, ref) => {
    const {primary, secondary} = COLOR_PALETTE.normal[value];

    const [isLit, setIsLit] = useState(false);

    const handleLitButton = (time: number) => {
      setIsLit(true);
      delay(() => setIsLit(false), time);
    };

    const handlePress = () => {
      onPress?.(value);
      Vibration.vibrate(LIT_ANIMATION_DURATION);
      handleLitButton(LIT_ANIMATION_DURATION);
    };

    const replayAnimation = () => {
      handleLitButton(REPLAY_ANIMATION_DURATION);
    };

    const renderContent = () => {
      return useNumbers ? (
        <Text>{value}</Text>
      ) : (
        <Svg width={128} height={128} fill="none" viewBox="0 -0.5 224 224">
          <Path
            stroke="#000000"
            d="M14 0h196M14 1h196M14 2h196M14 3h196M14 4h196M14 5h196M14 6h196M7 7h210M7 8h210M7 9h210M7 10h210M7 11h210M7 12h210M7 13h210M0 14h224M0 15h224M0 16h224M0 17h224M0 18h224M0 19h224M0 20h224M0 21h21M203 21h21M0 22h21M203 22h21M0 23h21M203 23h21M0 24h21M203 24h21M0 25h21M203 25h21M0 26h21M203 26h21M0 27h21M203 27h21M0 28h21M203 28h21M0 29h21M203 29h21M0 30h21M203 30h21M0 31h21M203 31h21M0 32h21M203 32h21M0 33h21M203 33h21M0 34h21M203 34h21M0 35h21M203 35h21M0 36h21M203 36h21M0 37h21M203 37h21M0 38h21M203 38h21M0 39h21M203 39h21M0 40h21M203 40h21M0 41h21M203 41h21M0 42h21M203 42h21M0 43h21M203 43h21M0 44h21M203 44h21M0 45h21M203 45h21M0 46h21M203 46h21M0 47h21M203 47h21M0 48h21M203 48h21M0 49h21M203 49h21M0 50h21M203 50h21M0 51h21M203 51h21M0 52h21M203 52h21M0 53h21M203 53h21M0 54h21M203 54h21M0 55h21M203 55h21M0 56h21M203 56h21M0 57h21M203 57h21M0 58h21M203 58h21M0 59h21M203 59h21M0 60h21M203 60h21M0 61h21M203 61h21M0 62h21M203 62h21M0 63h21M203 63h21M0 64h21M203 64h21M0 65h21M203 65h21M0 66h21M203 66h21M0 67h21M203 67h21M0 68h21M203 68h21M0 69h21M203 69h21M0 70h21M203 70h21M0 71h21M203 71h21M0 72h21M203 72h21M0 73h21M203 73h21M0 74h21M203 74h21M0 75h21M203 75h21M0 76h21M203 76h21M0 77h21M203 77h21M0 78h21M203 78h21M0 79h21M203 79h21M0 80h21M203 80h21M0 81h21M203 81h21M0 82h21M203 82h21M0 83h21M203 83h21M0 84h21M203 84h21M0 85h21M203 85h21M0 86h21M203 86h21M0 87h21M203 87h21M0 88h21M203 88h21M0 89h21M203 89h21M0 90h21M203 90h21M0 91h21M203 91h21M0 92h21M203 92h21M0 93h21M203 93h21M0 94h21M203 94h21M0 95h21M203 95h21M0 96h21M203 96h21M0 97h21M203 97h21M0 98h21M203 98h21M0 99h21M203 99h21M0 100h21M203 100h21M0 101h21M203 101h21M0 102h21M203 102h21M0 103h21M203 103h21M0 104h21M203 104h21M0 105h21M203 105h21M0 106h21M203 106h21M0 107h21M203 107h21M0 108h21M203 108h21M0 109h21M203 109h21M0 110h21M203 110h21M0 111h21M203 111h21M0 112h21M203 112h21M0 113h21M203 113h21M0 114h21M203 114h21M0 115h21M203 115h21M0 116h21M203 116h21M0 117h21M203 117h21M0 118h21M203 118h21M0 119h21M203 119h21M0 120h21M203 120h21M0 121h21M203 121h21M0 122h21M203 122h21M0 123h21M203 123h21M0 124h21M203 124h21M0 125h21M203 125h21M0 126h21M203 126h21M0 127h21M203 127h21M0 128h21M203 128h21M0 129h21M203 129h21M0 130h21M203 130h21M0 131h21M203 131h21M0 132h21M203 132h21M0 133h21M203 133h21M0 134h21M203 134h21M0 135h21M203 135h21M0 136h21M203 136h21M0 137h21M203 137h21M0 138h21M203 138h21M0 139h21M203 139h21M0 140h21M203 140h21M0 141h21M203 141h21M0 142h21M203 142h21M0 143h21M203 143h21M0 144h21M203 144h21M0 145h21M203 145h21M0 146h21M203 146h21M0 147h21M203 147h21M0 148h21M203 148h21M0 149h21M203 149h21M0 150h21M203 150h21M0 151h21M203 151h21M0 152h21M203 152h21M0 153h21M203 153h21M0 154h21M203 154h21M0 155h21M203 155h21M0 156h21M203 156h21M0 157h21M203 157h21M0 158h21M203 158h21M0 159h21M203 159h21M0 160h21M203 160h21M0 161h21M203 161h21M0 162h21M203 162h21M0 163h21M203 163h21M0 164h21M203 164h21M0 165h21M203 165h21M0 166h21M203 166h21M0 167h21M203 167h21M0 168h21M203 168h21M0 169h21M203 169h21M0 170h21M203 170h21M0 171h21M203 171h21M0 172h21M203 172h21M0 173h21M203 173h21M0 174h21M203 174h21M0 175h21M203 175h21M0 176h21M203 176h21M0 177h21M203 177h21M0 178h21M203 178h21M0 179h21M203 179h21M0 180h21M203 180h21M0 181h21M203 181h21M0 182h21M203 182h21M0 183h21M203 183h21M0 184h21M203 184h21M0 185h21M203 185h21M0 186h21M203 186h21M0 187h21M203 187h21M0 188h21M203 188h21M0 189h21M203 189h21M0 190h21M203 190h21M0 191h21M203 191h21M0 192h21M203 192h21M0 193h21M203 193h21M0 194h21M203 194h21M0 195h21M203 195h21M0 196h21M203 196h21M0 197h21M203 197h21M0 198h21M203 198h21M0 199h21M203 199h21M0 200h21M203 200h21M0 201h21M203 201h21M0 202h21M203 202h21M0 203h224M0 204h224M0 205h224M0 206h224M0 207h224M0 208h224M0 209h224M7 210h210M7 211h210M7 212h210M7 213h210M7 214h210M7 215h210M7 216h210M14 217h196M14 218h196M14 219h196M14 220h196M14 221h196M14 222h196M14 223h196"
          />
          <Path
            stroke={isLit ? primary : neutral.white}
            d="M21 21h140M21 22h140M21 23h140M21 24h140M21 25h140M21 26h140M21 27h140M21 28h140M21 29h140M21 30h140M21 31h140M21 32h140M21 33h140M21 34h140M21 35h168M21 36h168M21 37h168M21 38h168M21 39h168M21 40h168M21 41h168M21 42h168M21 43h168M21 44h168M21 45h168M21 46h168M21 47h168M21 48h168M21 49h168M21 50h168M21 51h168M21 52h168M21 53h168M21 54h168M21 55h168M21 56h168M21 57h168M21 58h168M21 59h168M21 60h168M21 61h168M21 62h168M21 63h182M21 64h182M21 65h182M21 66h182M21 67h182M21 68h182M21 69h182M21 70h182M21 71h182M21 72h182M21 73h182M21 74h182M21 75h182M21 76h182M21 77h182M21 78h182M21 79h182M21 80h182M21 81h182M21 82h182M21 83h182M21 84h182M21 85h182M21 86h182M21 87h182M21 88h182M21 89h182M21 90h182M21 91h182M21 92h182M21 93h182M21 94h182M21 95h182M21 96h182M21 97h182M21 98h182M21 99h182M21 100h182M21 101h182M21 102h182M21 103h182M21 104h182M21 105h182M21 106h182M21 107h182M21 108h182M21 109h182M21 110h182M21 111h182M21 112h182M21 113h182M21 114h182M21 115h182M21 116h182M21 117h182M21 118h182M21 119h182M21 120h182M21 121h182M21 122h182M21 123h182M21 124h182M21 125h182M21 126h182M21 127h182M21 128h182M21 129h182M21 130h182M21 131h182M21 132h182M21 133h182M21 134h182M21 135h182M21 136h182M21 137h182M21 138h182M21 139h182M21 140h182M21 141h182M21 142h182M21 143h182M21 144h182M21 145h182M21 146h182M21 147h182M21 148h182M21 149h182M21 150h182M21 151h182M21 152h182M21 153h182M21 154h182M21 155h182M21 156h182M21 157h182M21 158h182M21 159h182M21 160h182M21 161h182M21 162h182M21 163h182M21 164h182M21 165h182M21 166h182M21 167h182M21 168h182M21 169h182M21 170h182M21 171h182M21 172h182M21 173h182M21 174h182M21 175h182M21 176h182M21 177h182M21 178h182M21 179h182M21 180h182M21 181h182M21 182h182M21 183h182M21 184h182M21 185h182M21 186h182M21 187h182M21 188h182M21 189h182M21 190h182M21 191h182M21 192h182M21 193h182M21 194h182M21 195h182M21 196h182M21 197h182M21 198h182M21 199h182M21 200h182M21 201h182M21 202h182"
          />
          <Path
            stroke={isLit ? secondary : neutral.whitec4}
            d="M161 21h42M161 22h42M161 23h42M161 24h42M161 25h42M161 26h42M161 27h42M161 28h42M161 29h42M161 30h42M161 31h42M161 32h42M161 33h42M161 34h42M189 35h14M189 36h14M189 37h14M189 38h14M189 39h14M189 40h14M189 41h14M189 42h14M189 43h14M189 44h14M189 45h14M189 46h14M189 47h14M189 48h14M189 49h14M189 50h14M189 51h14M189 52h14M189 53h14M189 54h14M189 55h14M189 56h14M189 57h14M189 58h14M189 59h14M189 60h14M189 61h14M189 62h14"
          />
        </Svg>
      );
    };

    useImperativeHandle(ref, () => ({replayAnimation}));

    return (
      <Pressable onPress={handlePress} disabled={isDisabled}>
        {renderContent()}
      </Pressable>
    );
  },
);

export const ColorValueButton = memo(ColorValueButtonComponent);
